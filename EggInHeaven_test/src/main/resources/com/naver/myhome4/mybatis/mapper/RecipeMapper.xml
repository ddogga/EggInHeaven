<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.naver.myhome4.mybatis.mapper.RecipeMapper">
	
	<!-- 신호준 -->
	<insert id="insertRecipe" parameterType="recipe">
		<selectKey resultType="int"      order="BEFORE" 
	                keyProperty="recipe_num">
	      select nvl(max(recipe_num) + 1, 0) from recipe 
	    </selectKey>
		INSERT
		INTO RECIPE
		VALUES(#{recipe_num},#{member_id},#{recipe_title},#{recipe_content},
		#{recipe_time},#{recipe_readcount},#{recipe_best},SYSDATE)
	</insert>
	
	<delete id="recipeDelete">
 			delete from recipe
   			 where r_num=#{recipe_num}
	</delete>

	<update id="recipeModify" parameterType="recipe">
		UPDATE recipe
		SET recipe_title = #{recipe_title}, 
			recipe_content = #{recipe_content}, 
			recipe_time = #{recipe_time}
		WHERE recipe_num=#{recipe_num}
	</update>
	
	<!-- 변재혁 -->
	<select id="getDetail" resultType="recipe">
		select *
		from recipe
		where recipe_num = #{num}
	</select>
	
	<select id="getSauce" resultType="sauce">
		select *
		from sauce
		where recipe_num = #{num}
	</select>
	
	<select id="getMaterial" resultType="material">
		select *
		from material
		where recipe_num = #{num}
	</select>	
		
	<select id="isAddedToLikeListTable" resultType="int">
		select count(*)
		from like_list
		where member_id = #{member_id} and recipe_num = #{recipe_num}
	</select>
	
	<delete id="removeFromLikeListTable">
		delete 
		from like_list
		where member_id = #{member_id} and recipe_num = #{recipe_num}
	</delete>
	
	<insert id="addToLikeListTable">
		insert
		into like_list
		values(#{member_id}, #{recipe_num})
	</insert>
	
	<select id="isBested" resultType="int">
		select count(*)
		from best_list
		where member_id = #{member_id} and recipe_num = #{recipe_num}
	</select>
	
	<delete id="removeFromBestListTable">
		delete 
		from best_list 
		where member_id = #{member_id} and recipe_num = #{recipe_num}
	</delete>
	
	<update id="decreaseBestRecipe">
		update recipe
		set recipe_best = recipe_best - 1
		where recipe_num = #{recipe_num}
	</update>
	
	<insert id="addToBestListTable">
		insert
		into best_list
		values(#{member_id}, #{recipe_num})
	</insert>
	
	<update id="increaseBestRecipe">
		update recipe
		set recipe_best = recipe_best + 1
		where recipe_num = #{recipe_num}
	</update>
	
	<!-- 게시글의 추천 수 가져오기 -->
	<select id="getRecipeBestCount" resultType="int">
		select recipe_best
		from recipe
		where recipe_num = #{recipe_num}
	</select>
	
	
	<select id="getCategories" resultType="categoryRecipeView">
		select rc.*, ma.matall_name, ma.category_num as category
		from recipe_category rc inner join material_all ma
			on rc.category_num = ma.matall_num
		where recipe_num = #{recipe_num}
		order by rc.category_num asc
	</select>
	
</mapper>
